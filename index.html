<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Visualizador de Ordenamientos â€” Python externo</title>

  <style>
    /* === VARIABLES === */
    :root {
      --bg: #006666;
      --panel: #111827;
      --muted: #94a3b8;
      --text: #e2e8f0;
      --accent: #22d3ee;
    }

    * { box-sizing: border-box; }

    /* === GENERAL === */
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Arial;
      background: linear-gradient(180deg, #0b1220, var(--bg));
      color: var(--text);
      min-height: 100vh;
      display: grid;
      grid-template-rows: auto 1fr;
    }

    header {
      padding: 16px 20px;
      border-bottom: 1px solid #1f2937;
      background: rgba(17, 24, 39, .75);
      backdrop-filter: blur(6px);
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    h1 {
      font-size: 18px;
      margin: 0;
      letter-spacing: .3px;
    }

    .pill {
      padding: 4px 10px;
      border-radius: 999px;
      background: #1f2937;
      color: var(--muted);
      font-size: 12px;
    }

    main {
      padding: 12px 16px 20px;
      display: grid;
      grid-template-rows: auto 1fr auto;
      gap: 12px;
    }

    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 10px;
      width: 100%;
    }

    .card {
      background: var(--panel);
      border: 1px solid #1f2937;
      border-radius: 14px;
      padding: 12px;
    }

    label {
      font-size: 12px;
      color: var(--muted);
      display: block;
      margin-bottom: 6px;
    }

    select,
    input[type=range],
    input[type=file] {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #334155;
      background: #0b1220;
      color: var(--text);
    }

    .row {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .row > * { flex: 1; }

    .btns {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    button {
      background: #ffcc99;
      color: var(--text);
      border: 1px solid #334155;
      padding: 10px 14px;
      border-radius: 12px;
      cursor: pointer;
      transition: transform .06s ease, border-color .2s ease;
    }

    button:hover { border-color: var(--accent); }
    button:active { transform: translateY(1px); }

    button.primary {
      border-color: var(--accent);
      box-shadow: inset 0 0 0 1px var(--accent);
    }

    #canvasWrap {
      background: #0b1220;
      border: 1px dashed #334155;
      border-radius: 16px;
      padding: 10px;
      position: relative;
    }

    #view {
      width: 100%;
      height: 64vh;
      display: block;
      border-radius: 10px;
      background:
        radial-gradient(1000px 500px at 20% -10%, rgba(34,211,238,.08), transparent 70%),
        radial-gradient(900px 500px at 80% 110%, rgba(167,139,250,.08), transparent 70%),
        #0a0f1d;
    }

    .footer {
      color: var(--muted);
      font-size: 12px;
      text-align: center;
      padding: 8px 0;
    }

    .kbd {
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      background: #0b1220;
      border: 1px solid #334155;
      padding: 2px 6px;
      border-radius: 6px;
    }
  </style>

  <!-- Pyodide -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.26.0/full/pyodide.js" defer></script>

  <script defer>
    'use strict';


    function $(id){ return document.getElementById(id); }

    var canvas = null, ctx = null, DPR = 1;

    function ensureCanvas() {
      var wrap = $('canvasWrap');
      if (!canvas) {
        canvas = document.createElement('canvas');
        canvas.id = 'view';
        wrap.appendChild(canvas);
      }

      DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      var rect = wrap.getBoundingClientRect();

      canvas.width = Math.floor(rect.width * DPR);
      canvas.height = Math.floor(rect.height * DPR);
      canvas.style.width = rect.width + 'px';
      canvas.style.height = rect.height + 'px';

      ctx = canvas.getContext('2d');
      ctx.imageSmoothingEnabled = false;
    }

    window.addEventListener('resize', () => { ensureCanvas(); draw(); });

    function clearCanvas() {
      if (!ctx) return;
      ctx.save();
      ctx.setTransform(1, 0, 0, 1, 0, 0);
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.restore();
    }

    function columnWidths(n, total) {
      var widths = new Array(n), accPrev = 0;
      for (var i = 0; i < n; i++) {
        var accNext = Math.round(((i + 1) * total) / n);
        widths[i] = accNext - accPrev;
        accPrev = accNext;
      }
      return widths;
    }

    /* ===== Estado global ===== */
    var state = {
      mode: 'bars',
      items: [],
      original: [],
      running: false,
      speed: 50,
      highlight: { a: null, b: null },
      imageBitmap: null
    };

    /* === Helpers === */
    function randInt(min, max){ return (Math.random()*(max-min+1)+min)|0; }

    function shuffleArray(a){
      for (var i=a.length-1; i>0; i--){
        var j = randInt(0, i);
        var t=a[i]; a[i]=a[j]; a[j]=t;
      }
    }

    /* === Dataset barra === */
    function makeBars(n){
      var vals = new Array(n);
      for(var i=0;i<n;i++) vals[i] = i+1;
      shuffleArray(vals);

      var out = new Array(n);
      for(var k=0;k<n;k++){
        out[k] = { value: vals[k], originalIndex: vals[k]-1 };
      }
      return out;
    }

    /* === Dataset por columnas de imagen === */
    function makeImageColumns(n){
      return new Promise(function(resolve){
        if(!state.imageBitmap){
          var off = document.createElement('canvas');
          off.width = 800; off.height = 500;

          var octx = off.getContext('2d');
          octx.imageSmoothingEnabled = false;

          var grad = octx.createLinearGradient(0,0,off.width,off.height);
          grad.addColorStop(0,'#38bdf8');
          grad.addColorStop(1,'#a78bfa');

          octx.fillStyle = grad;
          octx.fillRect(0,0,off.width,off.height);

          state.imageBitmap = off;
        }

        var img = state.imageBitmap,
            W = img.width,
            H = img.height,
            colW = Math.max(1, Math.floor(W / n));

        var pieces = [];

        for (var i=0; i<n; i++){
          var slice = document.createElement('canvas');
          slice.width = colW;
          slice.height = H;

          var sctx = slice.getContext('2d');
          sctx.drawImage(img, i*colW,0, colW,H, 0,0, colW,H);

          pieces.push({ originalIndex:i, slice:slice });
        }

        shuffleArray(pieces);

        var out = pieces.map(p => ({
          value: p.originalIndex,
          bitmap: p.slice,
          originalIndex: p.originalIndex
        }));

        resolve(out);
      });
    }

    /* === Dibujo === */
    function draw(){ /* ... SE MANTIENE IGUAL ... */ }

    /* === Pyodide === */
    var py = null, pyStepFn = null;

    function ensurePy(){ /* ... */ }
    function loadStudentCode(path){ /* ... */ }
    function pyInit(values){ /* ... */ }
    function pyStep(){ /* ... */ }

    /* === Control === */
    function rebuildData(){ /* ... */ }
    function onShuffle(){ /* ... */ }
    function run(){ /* ... */ }
    function stepOnce(){ /* ... */ }
    function reset(){ /* ... */ }

    /* === Listeners === */
    document.addEventListener('DOMContentLoaded', function(){
      ensureCanvas();

      $('mode').addEventListener('change', function(){
        state.mode = this.value;
        rebuildData();
      });

      $('algorithm').addEventListener('change', rebuildData);

      $('size').addEventListener('input', function(){
        $('sizeVal').textContent = this.value;
        rebuildData();
      });

      $('speed').addEventListener('input', function(){
        $('speedVal').textContent = this.value + ' ms';
        state.speed = parseInt(this.value,10);
      });

      $('shuffle').addEventListener('click', onShuffle);
      $('play').addEventListener('click', () => { if(!state.running) run(); });
      $(

